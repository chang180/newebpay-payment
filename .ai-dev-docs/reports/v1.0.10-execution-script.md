# v1.0.10 Block Display 升級 - 執行腳本

> 📋 **執行指南**: 請按照此腳本的順序逐步執行，每個階段完成後進行驗證再繼續

## 🚀 執行前準備

### 1. 環境檢查
```bash
# 檢查當前版本
grep "Version:" d:\coding\wordpress\wp-content\plugins\newebpay-payment\Central.php

# 檢查 WordPress 和 WooCommerce 版本
# 確保支援 Gutenberg 區塊編輯器
```

### 2. 備份和分支管理
```bash
# 建立開發分支
git checkout -b feature/v1.0.10-block-display

# 確認當前狀態
git status
```

### 3. 開發工具準備
- VS Code 或其他編輯器
- Node.js (用於區塊開發)
- WordPress 測試環境

---

## 🏗️ 階段一：基礎架構建立

### 任務 1.1：建立目錄結構
**預估時間**: 30 分鐘

```bash
# 建立 blocks 目錄結構
mkdir -p includes/blocks/assets/js
mkdir -p includes/blocks/assets/css
mkdir -p includes/blocks/src/payment-block
mkdir -p includes/blocks/src/build
```

### 任務 1.2：建立主要管理類別
**檔案**: `includes/blocks/class-newebpay-blocks.php`
**預估時間**: 45 分鐘

**重點實作**:
- 單例模式設計
- 區塊註冊機制
- 資產載入管理
- 與現有架構整合

### 任務 1.3：整合到主檔案
**檔案**: `Central.php`
**預估時間**: 30 分鐘

**修改內容**:
- 引入 blocks 模組
- 初始化區塊功能
- 確保向後相容

### 任務 1.4：基礎資產檔案
**預估時間**: 45 分鐘

**建立檔案**:
- `assets/js/payment-block.js` - 基礎 JavaScript
- `assets/css/payment-block.css` - 基礎樣式
- `src/payment-block/index.js` - React 入口

### ✅ 階段一驗證
- [x] 目錄結構正確建立
- [x] 類別檔案無語法錯誤
- [x] WordPress 後台無錯誤訊息
- [x] 插件可正常啟用

---

## 💳 階段二：核心付款區塊開發

### 任務 2.1：付款方式選擇區塊
**預估時間**: 2 小時

**核心功能**:
- 顯示可用付款方式
- 管理員設定介面
- 前端使用者選擇介面

### 任務 2.2：區塊編輯器整合
**預估時間**: 1.5 小時

**實作重點**:
- Block Editor 編輯介面
- 區塊屬性設定
- 即時預覽功能

### 任務 2.3：前端顯示邏輯
**預估時間**: 1 小時

**關鍵整合**:
- 與現有 `nwpMPG.php` 整合
- 付款流程無縫銜接
- 樣式與主題相容

### 任務 2.4：響應式設計
**預估時間**: 30 分鐘

**設計重點**:
- 行動裝置相容
- 各種螢幕尺寸適配
- 主流主題相容性

### ✅ 階段二驗證
- [ ] 區塊可正常新增到頁面
- [ ] 編輯器設定功能正常
- [ ] 前端顯示正確
- [ ] 付款流程可正常運作
- [ ] 行動端體驗良好

---

## 🔧 階段三：進階功能整合

### 任務 3.1：電子發票區塊
**預估時間**: 1.5 小時

**整合功能**:
- 發票開立設定
- 發票查詢功能
- 與 `nwpElectronicInvoice.php` 整合

### 任務 3.2：智慧ATM2.0 支援
**預估時間**: 1 小時

**特殊處理**:
- 智慧ATM2.0 參數顯示
- 特殊設定選項
- 測試模式支援

### 任務 3.3：付款狀態區塊
**預估時間**: 1 小時

**功能開發**:
- 即時狀態顯示
- 訂單追蹤功能
- 錯誤狀態處理

### 任務 3.4：交易歷史區塊
**預估時間**: 30 分鐘

**資料顯示**:
- 用戶交易記錄
- 分頁功能
- 篩選和搜尋

### ✅ 階段三驗證
- [ ] 電子發票功能正常
- [ ] 智慧ATM2.0 可正確顯示
- [ ] 付款狀態即時更新
- [ ] 交易歷史正確顯示

---

## 🧪 階段四：測試與優化

### 任務 4.1：功能測試
**預估時間**: 1 小時

**測試項目**:
- 所有區塊基本功能
- 不同付款方式測試
- 錯誤情況處理

### 任務 4.2：相容性測試
**預估時間**: 1 小時

**測試範圍**:
- 不同 WordPress 主題
- 不同瀏覽器
- 行動裝置測試

### 任務 4.3：效能優化
**預估時間**: 45 分鐘

**優化重點**:
- 資源載入優化
- 快取機制設定
- 資料庫查詢優化

### 任務 4.4：安全性檢查
**預估時間**: 15 分鐘

**檢查項目**:
- 輸入驗證
- 權限控制
- 資料清理

### ✅ 階段四驗證
- [ ] 所有功能測試通過
- [ ] 效能符合標準
- [ ] 安全性檢查通過
- [ ] 相容性測試完成

---

## 📚 階段五：文件與發布準備

### 任務 5.1：版本資訊更新
**預估時間**: 30 分鐘

**更新檔案**:
- `Central.php` - 版本號更新為 1.0.10
- `readme.txt` - 新增區塊功能說明
- 版本歷史記錄

### 任務 5.2：使用說明文件
**預估時間**: 45 分鐘

**建立文件**:
- 區塊使用指南
- 管理員設定說明
- 疑難排解指南

### 任務 5.3：API 文件更新
**預估時間**: 15 分鐘

**更新內容**:
- 新增區塊相關 API
- Hook 和 Filter 說明
- 開發者指南

### 任務 5.4：最終測試
**預估時間**: 30 分鐘

**全面測試**:
- 完整付款流程
- 所有區塊功能
- 升級過程測試

### ✅ 階段五驗證
- [ ] 版本資訊正確更新
- [ ] 文件完整且準確
- [ ] 最終測試全部通過
- [ ] 發布準備完成

---

## 🎯 執行順序建議

### 第一天 (4-5 小時)
1. ✅ 完成階段一 (基礎架構)
2. ✅ 開始階段二 (核心區塊開發)

### 第二天 (4-5 小時)  
1. ✅ 完成階段二
2. ✅ 完成階段三 (進階功能)

### 第三天 (3-4 小時)
1. ✅ 完成階段四 (測試優化)
2. ✅ 完成階段五 (發布準備)

## ⚠️ 重要注意事項

### 開發原則
1. **向後相容**: 確保現有功能不受影響
2. **漸進增強**: 區塊功能為額外增強，不破壞原有流程
3. **測試優先**: 每階段完成後立即測試
4. **文件同步**: 開發過程中同步更新文件

### 緊急處理
如果某階段遇到重大問題：
1. 立即停止當前階段
2. 回退到上一個穩定狀態
3. 分析問題並調整計劃
4. 重新評估時程安排

### 品質檢查
每階段完成後的必要檢查：
- [ ] 代碼語法正確
- [ ] 功能運作正常
- [ ] 無錯誤日誌
- [ ] 效能影響最小

---

**腳本狀態**: 📋 準備就緒，可開始執行  
**建議執行方式**: 嚴格按階段順序，完成一階段再進行下一階段  
**預估完成時間**: 12-17 小時（分 3 天執行）
