# Newebpay Payment v1.0.10 - Block Display 支援升級計劃

> 📅 **計劃建立日期**: 2025年8月30日  
> 🎯 **目標版本**: 1.0.10  
> 🔧 **主要功能**: Block Display 支援（Gutenberg 區塊編輯器）

## 📋 升級概述

### 主要目標
為 Newebpay Payment 插件添加 WordPress Gutenberg 區塊編輯器的完整支援，讓用戶可以在區塊編輯器中使用付款功能。

### 當前狀況分析
- **當前版本**: 1.0.9 
- **已完成功能**: 智慧ATM2.0整合、API版本2.3
- **缺少功能**: Gutenberg Block 支援
- **架構現況**: 傳統 PHP 模式，無區塊編輯器整合

## 🎯 升級階段規劃

### 階段一：基礎架構建立 🏗️
**預估時間**: 2-3 小時
**目標**: 建立 blocks 模組的基礎架構

#### 任務清單
- [ ] 建立 `includes/blocks/` 目錄結構
- [ ] 建立區塊主要管理類別 `class-newebpay-blocks.php`
- [ ] 建立區塊註冊和初始化機制
- [ ] 更新主檔案 `Central.php` 整合 blocks 模組
- [ ] 建立基礎的資產管理（CSS/JS）

#### 檔案結構
```
includes/blocks/
├── class-newebpay-blocks.php          # 主要區塊管理類別
├── assets/                            # 區塊資源檔案
│   ├── js/
│   │   ├── payment-block.js           # 付款區塊 JS
│   │   └── payment-block.asset.php    # 資產相依性
│   └── css/
│       └── payment-block.css          # 區塊樣式
└── src/                               # 原始碼（如使用 React）
    ├── payment-block/
    │   ├── index.js                   # 區塊入口
    │   ├── edit.js                    # 編輯介面
    │   └── save.js                    # 前端顯示
    └── build/                         # 編譯後檔案
```

### 階段二：核心付款區塊開發 💳
**預估時間**: 4-5 小時
**目標**: 開發基礎的付款方式選擇區塊

#### 任務清單
- [ ] 開發付款方式選擇區塊 `payment-methods-block`
- [ ] 實作區塊的編輯介面（Block Editor）
- [ ] 實作區塊的前端顯示邏輯
- [ ] 整合現有的付款方式設定
- [ ] 建立區塊的屬性設定介面

#### 功能特性
- 顯示可用的付款方式
- 管理員可在區塊中設定顯示哪些付款方式
- 支援拖拉排序付款方式順序
- 響應式設計支援

### 階段三：進階功能整合 🔧
**預估時間**: 3-4 小時
**目標**: 整合電子發票和特殊付款功能

#### 任務清單
- [ ] 整合電子發票功能到區塊中
- [ ] 支援智慧ATM2.0在區塊中的顯示
- [ ] 建立付款狀態顯示區塊
- [ ] 實作訂單資訊顯示區塊
- [ ] 新增付款歷史查詢區塊

#### 區塊類型
1. **電子發票設定區塊** - 讓用戶在前端設定發票資訊
2. **付款狀態區塊** - 顯示訂單付款狀態
3. **交易紀錄區塊** - 顯示用戶的交易歷史

### 階段四：測試與優化 🧪
**預估時間**: 2-3 小時
**目標**: 全面測試和效能優化

#### 任務清單
- [ ] 建立區塊功能測試腳本
- [ ] 進行不同主題的相容性測試
- [ ] 效能優化（資源載入、快取）
- [ ] 行動裝置響應式測試
- [ ] 與現有功能的整合測試

### 階段五：文件與發布準備 📚
**預估時間**: 1-2 小時
**目標**: 完善文件和發布準備

#### 任務清單
- [ ] 更新 README.txt 和版本資訊
- [ ] 建立區塊使用說明文件
- [ ] 更新 API 文檔
- [ ] 建立升級指南
- [ ] 測試環境驗證

## 🔧 技術實作細節

### 區塊開發技術棧
- **前端**: React + WordPress Block Editor API
- **建置工具**: WordPress @wordpress/scripts
- **樣式**: CSS + WordPress 區塊樣式標準
- **PHP**: WordPress Block API 整合

### 主要 API 整合點
1. **`register_block_type()`** - 註冊區塊
2. **`wp_enqueue_block_editor_assets()`** - 載入編輯器資源
3. **`wp_enqueue_block_assets()`** - 載入前端資源
4. **區塊屬性管理** - 使用 WordPress 標準屬性系統

### 資料流整合
- 利用現有的 `nwpMPG.php` 付款邏輯
- 整合 `nwpSetting.php` 設定管理
- 連接 `nwpElectronicInvoice.php` 發票功能

## 📊 風險評估與對策

### 高風險項目
1. **與現有功能衝突** 
   - 對策：漸進式整合，保持向後相容
2. **主題相容性問題**
   - 對策：使用 WordPress 標準區塊 API
3. **效能影響**
   - 對策：按需載入資源，使用快取機制

### 中風險項目
1. **使用者介面複雜度**
   - 對策：簡化設定選項，提供預設範本
2. **移動端體驗**
   - 對策：優先設計響應式區塊

## 🎯 成功指標

### 功能指標
- [ ] 所有現有付款方式都支援區塊顯示
- [ ] 區塊編輯器中可正常設定和預覽
- [ ] 前端區塊正常運作且樣式正確
- [ ] 電子發票功能在區塊中正常運作

### 效能指標
- [ ] 頁面載入時間增加不超過 200ms
- [ ] 區塊編輯器回應時間 < 1 秒
- [ ] 行動端體驗流暢

### 相容性指標
- [ ] 支援最新 3 個 WordPress 版本
- [ ] 支援最新 3 個 WooCommerce 版本
- [ ] 支援主流 WordPress 主題

## 📋 執行檢查清單

### 開始前準備
- [ ] 備份當前 1.0.9 版本
- [ ] 建立開發分支
- [ ] 設定測試環境
- [ ] 準備必要開發工具

### 階段完成檢查
- [ ] 階段一：基礎架構 ✅
- [ ] 階段二：核心區塊 ✅  
- [ ] 階段三：進階整合 ✅
- [ ] 階段四：測試優化 ✅
- [ ] 階段五：發布準備 ✅

### 最終發布檢查
- [ ] 所有功能測試通過
- [ ] 效能測試符合標準
- [ ] 文件更新完成
- [ ] 版本號更新為 1.0.10
- [ ] 發布說明準備完成

## 📞 技術支援資源

- **WordPress Block Editor Handbook**: https://developer.wordpress.org/block-editor/
- **WooCommerce Blocks Development**: https://github.com/woocommerce/woocommerce-blocks
- **藍新金流 API 文檔**: https://www.newebpay.com/website/Page/content/download_api#2

---

> 💡 **重要提醒**: 此升級計劃採用階段式開發，每個階段完成後請進行測試，確保功能正常後再進行下一階段。保持與現有功能的完全相容性是最高優先級。

**計劃狀態**: 📋 規劃完成，等待執行  
**預估總時間**: 12-17 小時  
**建議執行方式**: 分階段執行，每階段完成後進行驗證
