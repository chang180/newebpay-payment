# 開發指南與最佳實務

## 1. 開發環境設定

### 必要環境
- PHP 8.0+
- WordPress 6.4+
- WooCommerce 6.4+
- MySQL 5.5+

### 測試設定
1. 將 `TestMode` 設為 `yes`
2. 使用測試環境的 API 端點
3. 配置測試商店代號和金鑰

## 2. 程式碼規範

### 命名規範
- 類別名稱使用 PascalCase
- 方法名稱使用 camelCase
- 常數使用 UPPER_CASE
- 變數使用 snake_case 或 camelCase

### 檔案結構
```php
<?php
// 安全檢查
if ( ! defined( 'ABSPATH' ) ) {
    exit;
}

class YourClassName {
    // 類別實作
}
```

### 錯誤處理
- 使用 WooCommerce 內建的日誌系統
- 適當的異常處理
- 用戶友善的錯誤訊息

## 3. 除錯技巧

### 日誌記錄
```php
$logger = wc_get_logger();
$logger->info('訊息內容', array('source' => 'newebpay'));
```

### 開發除錯
1. 啟用 WordPress 除錯模式
2. 檢查 WooCommerce 狀態頁面
3. 監控 API 請求和回應

## 4. 測試策略

### 單元測試
- 測試個別方法功能
- 模擬 API 回應
- 驗證加密/解密功能

### 整合測試
- 完整付款流程測試
- 不同付款方式測試
- 電子發票功能測試

### 用戶測試
- 前端付款流程
- 後台管理功能
- 行動裝置相容性

## 5. 效能最佳化

### 快取策略
- 適當使用 WordPress 快取
- 避免重複的 API 請求
- 最佳化資料庫查詢

### 資源載入
- 只在需要時載入腳本
- 壓縮 CSS 和 JavaScript
- 使用 CDN 載入資源

## 6. 安全性最佳實務

### 數據驗證
- 驗證所有輸入數據
- 清理輸出數據
- 使用 WordPress nonce

### API 安全
- 驗證 API 簽章
- 使用 HTTPS 通訊
- 適當的錯誤處理

## 7. 版本控制

### Git 工作流程
1. 功能分支開發
2. 程式碼審查
3. 測試通過後合併
4. 標記版本發布

### 版本號命名
遵循語意化版本控制：
- 主版本.次版本.修訂版本
- 例如：1.0.8

## 8. 文檔維護

### 程式碼註釋
- 類別和方法的 PHPDoc
- 複雜邏輯的說明
- API 使用範例

### 更新日誌
- 記錄所有變更
- 分類：新增、修正、移除
- 影響範圍說明

## 9. 部署checklist

### 發布前檢查
- [ ] 所有測試通過
- [ ] 程式碼審查完成
- [ ] 文檔更新
- [ ] 版本號更新
- [ ] 相容性測試

### 發布後監控
- 錯誤日誌監控
- 用戶回饋收集
- 效能指標追蹤

## 10. 常見問題處理

### 付款失敗
1. 檢查 API 金鑰設定
2. 驗證網路連線
3. 查看錯誤日誌

### 回調問題
1. 確認回調 URL 可達
2. 檢查簽章驗證
3. 查看伺服器日誌

### 電子發票問題
1. 驗證發票設定
2. 檢查商店資格
3. 確認 API 權限
